{% extends "base.html" %}

{% block title %}Metrics - Meta-Monitoring Dashboard{% endblock %}
{% block nav_metrics %}active{% endblock %}
{% block page_title %}Metrics & Trends{% endblock %}

{% block header_actions %}
<div style="display: flex; gap: 1rem; align-items: center;">
    <select id="timeframe-filter" class="filter-select" style="padding: 0.5rem; border: 1px solid var(--border); border-radius: 0.375rem;">
        <option value="24h">Last 24 Hours</option>
        <option value="7d" selected>Last 7 Days</option>
        <option value="30d">Last 30 Days</option>
        <option value="90d">Last 90 Days</option>
    </select>
</div>
{% endblock %}

{% block extra_css %}
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
{% endblock %}

{% block content %}
<!-- Current Metrics Summary -->
<div class="metrics-grid">
    <div class="card metric-card">
        <div class="card-body">
            <div class="metric-icon">‚úì</div>
            <div class="metric-info">
                <div class="metric-label">Fact Accuracy</div>
                <div class="metric-value large" id="current-fact-accuracy">--%</div>
                <div class="metric-trend" id="fact-accuracy-trend"></div>
            </div>
        </div>
    </div>

    <div class="card metric-card">
        <div class="card-body">
            <div class="metric-icon">üõ°Ô∏è</div>
            <div class="metric-info">
                <div class="metric-label">Guardrail Pass Rate</div>
                <div class="metric-value large" id="current-guardrail-rate">--%</div>
                <div class="metric-trend" id="guardrail-trend"></div>
            </div>
        </div>
    </div>

    <div class="card metric-card">
        <div class="card-body">
            <div class="metric-icon">‚ö°</div>
            <div class="metric-info">
                <div class="metric-label">Avg Response Time</div>
                <div class="metric-value large" id="current-response-time">-- ms</div>
                <div class="metric-trend" id="response-time-trend"></div>
            </div>
        </div>
    </div>

    <div class="card metric-card">
        <div class="card-body">
            <div class="metric-icon">üìä</div>
            <div class="metric-info">
                <div class="metric-label">Evaluations Run</div>
                <div class="metric-value large" id="evaluation-count">0</div>
                <div class="metric-trend" id="evaluation-trend"></div>
            </div>
        </div>
    </div>
</div>

<!-- Fact Accuracy Trend Chart -->
<div class="card">
    <div class="card-header">
        <h3>Fact Accuracy Over Time</h3>
    </div>
    <div class="card-body">
        <canvas id="fact-accuracy-chart" style="max-height: 300px;"></canvas>
    </div>
</div>

<!-- Guardrail Performance Chart -->
<div class="card">
    <div class="card-header">
        <h3>Guardrail Performance</h3>
    </div>
    <div class="card-body">
        <canvas id="guardrail-chart" style="max-height: 300px;"></canvas>
    </div>
</div>

<!-- Response Time Trend Chart -->
<div class="card">
    <div class="card-header">
        <h3>Response Time Trend</h3>
    </div>
    <div class="card-body">
        <canvas id="response-time-chart" style="max-height: 300px;"></canvas>
    </div>
</div>

<!-- Metrics Breakdown Table -->
<div class="card">
    <div class="card-header">
        <h3>Detailed Metrics History</h3>
    </div>
    <div class="card-body">
        <div id="metrics-table-container">
            <div class="loading-spinner">Loading metrics...</div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="/dashboard-static/js/metrics.js"></script>
{% endblock %}
